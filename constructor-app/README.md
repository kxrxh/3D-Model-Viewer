# 3D Assembly Viewer

Интерактивный просмотрщик 3D моделей с возможностью создания пошаговых инструкций по сборке, включая голосовое описание этапов.

## Функциональность

- Загрузка и отображение 3D моделей в форматах GLB, GLTF
- Создание пошаговых инструкций по сборке
- Добавление описаний к этапам сборки с помощью голосового ввода (Speech-to-Text)
- Различные режимы просмотра (последовательный, изолированный)
- Экспорт инструкций сборки в JSON формате или в виде полного пакета (ZIP архив с моделью и инструкциями)
- Оптимизированный производительный рендеринг

## Установка и запуск

### Предварительные требования

1. Установите [Bun](https://bun.sh/) для запуска проекта:
   ```bash
   curl -fsSL https://bun.sh/install | bash
   ```

2. Установите OpenAI Whisper для локального распознавания речи:
   ```bash
   # Установите через pip
   pip install -U openai-whisper

   # Или используя Conda
   conda install -c conda-forge openai-whisper
   ```

3. Установите необходимые зависимости:
   ```bash
   sudo apt-get install ffmpeg
   ```

### Запуск проекта

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/your-username/3d-assembly-viewer.git
   cd 3d-assembly-viewer
   ```

2. Установите зависимости:
   ```bash
   bun install
   ```

3. Запустите сервер разработки:
   ```bash
   bun run dev
   ```

4. Для запуска с локальным распознаванием речи:
   ```bash
   bun run start
   ```

## Использование голосового ввода

Приложение позволяет добавлять описания к этапам сборки с помощью голосового ввода:

1. Создайте новый этап сборки, нажав кнопку "Добавить сборку"
2. Выберите детали для данного этапа, нажав кнопку "Редактировать"
3. Для добавления описания, нажмите кнопку "Добавить описание"
4. В открывшемся окне нажмите на иконку микрофона для начала записи
5. Продиктуйте инструкции по сборке
6. Нажмите на иконку микрофона снова для остановки записи
7. Дождитесь окончания обработки записи
8. Нажмите "Готово" для сохранения описания

## Экспорт инструкций сборки

Приложение позволяет экспортировать созданные инструкции по сборке для использования в других приложениях:

1. Создайте необходимые этапы сборки с деталями и описаниями
2. Нажмите кнопку "Экспорт сборки" в верхней части панели сборок
3. Выберите желаемый формат экспорта:
   - **Только JSON** - экспорт файла с информацией об этапах сборки, деталях и описаниях
   - **Полный пакет (ZIP)** - экспорт ZIP-архива, содержащего как JSON с инструкциями, так и саму 3D модель
4. Нажмите "Экспортировать" для скачивания файла

### Формат экспортируемых данных

Экспортированный JSON-файл содержит следующую структуру:

```json
{
  "version": "1.0",
  "createdAt": "2023-05-01T12:34:56.789Z",
  "assemblyStages": [
    {
      "id": 1,
      "name": "Название этапа",
      "description": "Описание этапа сборки",
      "parts": ["part1", "part2", "part3"]
    },
    // дополнительные этапы
  ],
  "availableParts": ["part1", "part2", "part3", "part4"]
}
```

ZIP-архив содержит два файла:
- `assembly-instructions.json` - JSON-файл с инструкциями (структура та же)
- Исходный файл 3D-модели (например, `model.glb`)

## Технические детали

### Локальное распознавание речи

- Запись звука осуществляется через браузерный API `MediaRecorder`
- Обработка аудио и распознавание текста происходит локально на сервере с использованием модели Whisper
- По умолчанию используется модель `small`, обеспечивающая хороший баланс между точностью и скоростью
- Поддерживается русский язык и другие языки, доступные в Whisper


## Поддержка браузерами

Голосовой ввод реализован с использованием комбинации технологий для обеспечения максимальной совместимости:

- **Chrome/Edge**: Полная поддержка через Web Speech API
- **Firefox/Safari/Opera**: Базовая поддержка через MediaRecorder API с последующей обработкой аудио через Whisper


## Настройка Docker

Данное приложение контейнеризировано и развертывается с использованием Docker Compose и Traefik в качестве обратного прокси.

### Предварительные требования

- Docker
- Docker Compose

### Начало работы

1. Клонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd viewer-app
   ```

2. Настройте переменные окружения (опционально):
   - Отредактируйте файл `.env` для настройки домена, электронной почты и аутентификации

3. Соберите и запустите контейнеры:
   ```bash
   docker-compose up -d
   ```

4. Доступ к приложению:
   - Основное приложение: http://viewer-app.localhost (или ваш настроенный домен)
   - Панель управления Traefik: http://traefik.viewer-app.localhost (логин по умолчанию: admin/password)

## Развертывание в производственной среде

Для развертывания в производственной среде:

1. Обновите файл `.env` с вашим доменом и действительным адресом электронной почты для сертификатов Let's Encrypt:
   ```
   DOMAIN=your-domain.com
   ACME_EMAIL=your-email@example.com
   ```

2. Сгенерируйте безопасный пароль для панели управления Traefik:
   ```bash
   docker run --rm httpd:alpine htpasswd -nb admin your_secure_password
   ```
   Скопируйте вывод в переменную TRAEFIK_BASIC_AUTH в файле `.env`.

3. Запустите приложение:
   ```bash
   docker-compose up -d
   ```

4. Настройте DNS для указания на ваш сервер.

## Архитектура

- **Контейнер приложения**: Приложение на Bun.js с Whisper.cpp для распознавания речи
- **Traefik**: Обратный прокси, обрабатывающий SSL-терминацию и маршрутизацию

## Тома

- **whisper_data**: Постоянное хранилище для аудиофайлов
- **traefik_certificates**: Хранилище для сертификатов Let's Encrypt

## Безопасность

- HTTPS включен по умолчанию (с автоматической генерацией сертификатов)
- Панель управления Traefik защищена базовой аутентификацией

## Переменные окружения

| Переменная | Описание | Значение по умолчанию |
|------------|----------|------------------------|
| DOMAIN | Доменное имя для приложения | viewer-app.localhost |
| ACME_EMAIL | Email для Let's Encrypt | admin@example.com |
| TRAEFIK_BASIC_AUTH | Учетные данные для панели управления Traefik | admin:хешированный_пароль |
